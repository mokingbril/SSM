@{
    Layout = null;
    var AllSubs = ViewBag.Subs;
}

<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>申请录入成绩专区</title>
    <script src="~/Scripts/jquery-1.7.1.min.js"></script>
    <script src="~/Scripts/jquery.easyui.min.js"></script>
    <link href="~/Content/default/easyui.css" rel="stylesheet" />
    <link href="~/Content/icon.css" rel="stylesheet" />
</head>
<body>
    <div style="width:100%;height:100%;background:url(../Content/Images/back.png);overflow:auto;">
        <div class="easyui-window" title="申请录入" 
            data-options="iconCls:'icon-save',inline:true,closable:false,maximizable:false,minimizable:false,draggable:false,resizable:false" style="width: 423px;height: 268px;">
           <div class="easyui-layout" data-options="fit:true">
            <div data-options="region:'center'" style="padding: 10px;background:url(../Content/Images/back_d.jpg);">
                <table style="margin:0px auto;height:100%">
                    <tr><td>课程：</td><td><select id="aiSubId" name="SubId">
                        @foreach (var sb in AllSubs){<option value="@sb.SubId">@sb.Name</option>}</select></td></tr>
                    <tr><td>考试时间：</td><td><input type="datetime" id="aiExamTime" required name="ExamTime" value="@DateTime.Now.ToString()" editable="false" 
                        class="easyui-datetimebox" data-options="formatter:myformatter,parser:myparser" /></td></tr>
                    <tr><td>分数：</td><td><input type="text" id="aiTrueScore" required name="TrueScore" value=""/></td></tr>
                </table>
            </div>
            <div data-options="region:'south',border:false" style="text-align:right;padding:5px 0 0;">
				<a class="easyui-linkbutton" data-options="iconCls:'icon-ok'" href="javascript:void(0)" id="aibtnSave">确定</a>
			</div>
          </div>
       </div>
    </div>

    <script type="text/javascript">
        $("#aibtnSave").click(function () {
            if ($("#aiExamTime").val() == "" || $("#aiTrueScore").val() == "") {
                $.messager.alert("温馨提示", "考试时间和分数项目必填！", "warning");
                return;
            }
            var SId = $("#aiSubId option:selected").val();
            $.ajax({
                url: "/Record/ApplyInsert",
                type: "POST",
                data: {
                    "SubId": SId , "TrueScore": $("#aiTrueScore").val(), "ExamTime": $("#aiExamTime").val()
                },
                dataType: "text",
                success: function (data) {
                    if (data == "OK") {
                        $.messager.alert("温馨提示", "申请成功！", "info");
                    }
                    else {
                        $.messager.alert("温馨提示", "可能已存在此项或输入数据不正确，申请录入成绩失败！", "error");
                    }
                },
            });
        });

        $('#aiExamTime').datetimebox({
            showSeconds: false
        });
        function myformatter(date) {
            var y = date.getFullYear();
            var m = date.getMonth() + 1;
            var d = date.getDate();
            var h = date.getHours();
            var min = date.getMinutes();
            var sec = date.getSeconds();
            var str = y + '/' + (m < 10 ? ('0' + m) : m) + '/' + (d < 10 ? ('0' + d) : d) + ' ' + ' ' + (h < 10 ? ('0' + h) : h) + ':' + (min < 10 ? ('0' + min) : min) + ':' + (sec < 10 ? ('0' + sec) : sec);
            $("#aiExamTime").val(str);
            return str;
        }
        function myparser(s) {
            if (!s) return new Date();
            var y = s.substring(0, 4);
            var m = s.substring(5, 7);
            var d = s.substring(8, 10);
            var h = s.substring(11, 14);
            var min = s.substring(15, 17);
            var sec = s.substring(18, 20);
            if (!isNaN(y) && !isNaN(m) && !isNaN(d) && !isNaN(h) && !isNaN(min) && !isNaN(sec)) {
                return new Date(y, m - 1, d, h, min, sec);
            } else {
                return new Date();
            }
        }
    </script>
</body>
</html>
